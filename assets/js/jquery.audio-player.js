/**************************************************************************
 * HTML5 Audio Player
 * @info: http://www.codegrape.com/item/html5-audio-player/1600
 * @version: 1.0 (02/08/2016)
 * @requires: jQuery v1.7 or later (tested on 1.12.4)
 * @author: flashblue - http://www.codegrape.com/user/flashblue
**************************************************************************/

(function($){var win=window;var $win=$(win);var doc=document;var $doc=$(doc);var nav=navigator;var initCount=0;var collection=[];var animationFrameCollection=[];var flashCollection=[];var AUDIO_PLAYER_ID='HTML5AudioPlayer';var TEMPLATE='<ul class="HTML5AudioPlayer HTML5AudioPlayer-wrapper">						<li><div class="play-btn"></div></li>						<li><div class="seperator for-play"></div></li>						<li><div class="time-txt"> 00:00 </div></li>						<li><div class="seperator for-time"></div></li>						<li class="container">							<div class="progress-bar-container">								<div class="progress-bar-wrapper">									<div class="seek-bar"></div>									<div class="play-bar transition"></div>								</div>							</div>							</li>						<li><div class="seperator for-duration"></div></li>						<li><div class="duration-txt"> 00:00 </div></li>						<li><div class="seperator for-volume"></div></li>						<li><div class="volume-btn"></div></li>						<li>							<div class="volume-bar-container">								<div class="volume-bar"></div>							</div>						</li>					</ul>';var FN='fn';var SHOCKWAVE_FLASH="Shockwave Flash";var SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash";var FLASH_MIME_TYPE="application/x-shockwave-flash";var PLAYER_VERSION="10";var PREFIX_CALLBACK=AUDIO_PLAYER_ID+'_';var PREFIX_FLASH_PROTO='__flash__';var animationFrame=(((win.requestAnimationFrame&&win.cancelRequestAnimationFrame)?win.requestAnimationFrame:undefined)||((win.webkitRequestAnimationFrame&&win.webkitCancelRequestAnimationFrame)?win.webkitRequestAnimationFrame:undefined)||((win.mozRequestAnimationFrame&&win.mozCancelRequestAnimationFrame)?win.mozRequestAnimationFrame:undefined)||((win.oRequestAnimationFrame&&win.oCancelRequestAnimationFrame)?win.oRequestAnimationFrame:undefined)||((win.msRequestAnimationFrame&&win.msCancelRequestAnimationFrame)?win.msRequestAnimationFrame:undefined)||undefined);var cancelAnimationFrame=(win.cancelRequestAnimationFrame||win.webkitCancelRequestAnimationFrame||win.mozCancelRequestAnimationFrame||win.oCancelRequestAnimationFrame||win.msCancelRequestAnimationFrame||undefined);var Attributes={DATA_CONTROLS_TIME:'data-controls-time',DATA_CONTROLS_VOLUME:'data-controls-volume',DATA_CONTROLS_DURATION:'data-controls-duration',DATA_VOLUME:'data-volume',DATA_FALLBACK:'data-fallback',WIDTH:'width',HEIGHT:'height',CONTROLS:'controls'};if(isDefined($[FN][AUDIO_PLAYER_ID]))return;var isIE=msieCheck(8);function msieCheck(ver){var nAgt=navigator.userAgent;if((verOffset=nAgt.indexOf("MSIE"))!=-1){var fullVersion=nAgt.substring(verOffset+5);var majorVersion=parseInt(fullVersion,10);if(majorVersion<=ver){return true}}return false}if(isIE){doc.createElement('audio');doc.createElement('source')}function getObjectById(objectIdStr){var r=null;var o=doc.getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!='undefined'){r=o}else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n}}}return r}function flashAvailable(){if(!isDefined(this.available)){var playerVersion=null;var description=null;if(isDefined(nav.plugins)&&isObject(nav.plugins[SHOCKWAVE_FLASH])){description=nav.plugins[SHOCKWAVE_FLASH].description;if(description&&!(isDefined(nav.mimeTypes)&&isDefined(nav.mimeTypes[FLASH_MIME_TYPE])&&!isDefined(nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin))){description=description.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion=parseInt(description.replace(/^(.*)\..*$/,"$1"),10)}}else if(isDefined(win.ActiveXObject)){try{var activeXObject=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(activeXObject){description=activeXObject.GetVariable("$version");if(description){description=description.split(" ")[1].split(",");playerVersion=parseInt(description[0],10)}}}catch(e){}}this.available=(parseInt(PLAYER_VERSION,10)<=playerVersion)}return this.available}function createSWF(id,object,flashSrc,audioSrc,volume,loop,autoplay,preload){var element,key,value;var params={name:id,menu:"false",quality:"low",wmode:"window",allowScriptAccess:"sameDomain",flashvars:"src="+audioSrc+"&volume="+volume+"&loop="+loop+"&autoplay="+autoplay+"&preload="+preload+"&id="+id};if(isIE){params.movie=flashSrc;var txt='';for(key in params){value=params[key];txt+='<param name="'+key+'" value="'+value+'" />'}var div=$('<div>');object.after(div);div.get(0).outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="'+id+'" width="0" height="0">'+txt+'</object>'}else{element=$('<object id="'+id+'" width="0" height="0" data="'+flashSrc+'" type="'+FLASH_MIME_TYPE+'">');for(key in params){value=params[key];element.append($('<param name="'+key+'" value="'+value+'">'))}object.after(element)}}function callAnimationFrame(callback,index){if(isDefined(animationFrame)){if(isDefined(index)){callCancelAnimationFrame(index);var id=animationFrame(function(){animationFrameCollection[index]=null;callback.call()});animationFrameCollection[index]=id;return id}else{return animationFrame(callback)}}else{return callback.call()}}function callCancelAnimationFrame(index){if(index&&isDefined(cancelAnimationFrame)){var id=animationFrameCollection[index];if(id){cancelAnimationFrame(id)}}}function getAudioTypeBySource(source){var ext=getFileExtension(source);var type;if(ext){if(ext.match(/m(p3|3a)/i))type='mpeg';else if(ext.match(/m4a|mp4/i))type='mp4';else if(ext.match(/webm|webma/i))type='webm';else if(ext.match(/wav/i))type='wav';else if(ext.match(/og[ga]/i))type='ogg'}return isDefined(type)?'audio/'+type:''}function getFileExtension(filename){var ext=/^.+\.([^.]+)$/.exec(filename);return ext==null?null:ext[1]}function getCurrentTime(time,opt_duration){var t=parseInt(time,10),h=Math.floor(t/3600),m=Math.floor(t%3600/60),s=Math.floor(t%3600%60);if(opt_duration){var d=parseInt(opt_duration,10),dh=Math.floor(d/3600);return((h>0?(dh<10||h>9?h+":":"0"+h+":"):(dh>0?(dh<10?"0:":"00:"):""))+(m>0?(m<10?"0":"")+m+":":"00:")+(s<10?"0":"")+s)}else{return((h>0?h+":":"")+(m>0?(m<10?"0":"")+m+":":"00:")+(s<10?"0":"")+s)}}function keepInBound(value,max,min){var number=Number(value);max=Number(max)||1;min=Number(min)||0;return number>=max?max:(number<=min?min:number)}function pauseAllAudioExcept(element){each(collection,function(){if(element!=this&&!this.paused()){this.pause()}})}function getOffsetLeft(object){var x=0;var element=object['get'](0);while(element&&!isNaN(element.offsetLeft)){x+=element.offsetLeft;element=element.offsetParent}return x}function roundNumber(value){return Math.round(Number(value)*10)/10}function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*86400000));var expires='; expires='+date.toGMTString()}else{var expires=''}doc.cookie=name+"="+value+expires+"; path=/"}function readCookie(name){var nameEQ=name+"=";var ca=doc.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null}function setVolumeState(volume){if(isDefined(win.localStorage)){try{localStorage.setItem(AUDIO_PLAYER_ID,volume)}catch(e){createCookie(AUDIO_PLAYER_ID,volume,30)}}else{createCookie(AUDIO_PLAYER_ID,volume,30)}}function getVolumeState(){var volume;if(isDefined(win.localStorage)){try{volume=localStorage.getItem(AUDIO_PLAYER_ID)}catch(e){}}if(!isDefined(volume)||volume==null||isNaN(volume))volume=readCookie(AUDIO_PLAYER_ID);return isDefined(volume)&&volume!=null&&!isNaN(volume)?volume:null}function bind(element,eventName,fn){element['bind'](eventName,fn)}function unbind(element,opt_eventName,opt_fn){element['unbind'](opt_eventName,opt_fn)}function find(element,selector){return element['find'](selector)}function each(object,callback){return $(object)['each'](callback)}function is(element,selector){return element['is'](selector)}function proxy(fn,object){return $['proxy'](fn,object)}function isObject(val){return typeof val==='object'}function isDefined(val){return typeof(val)!=='undefined'}function isNaN(val){return!(val>=0||val<0)}function inherits(childCtor,parentCtor){//@constructor
function tempCtor(){};tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor();childCtor.prototype.constructor=childCtor}function EventTargetController(){this.events_=[]}EventTargetController.prototype.addEventListener=function(type,callback){this.events_[type]=this.events_[type]||[];this.events_[type].push(callback)};EventTargetController.prototype.removeEventListener=function(type,callback){var listeners=this.events_[type];if(listeners){each(listeners,function(i){if(this===callback){listeners.splice(i,1)}})}};EventTargetController.prototype.hasEventListener=function(type){return Boolean(this.events_[type]&&this.events_[type].length>0)};EventTargetController.prototype.dispatchEvent=function(type){var listeners=this.events_[type];if(listeners){var self=this;each(listeners,function(){this.call(self,type)})}};EventTargetController.prototype.destroy=function(){delete this.events_};function MediaController(object,element){EventTargetController.call(this);this.element_=element;this.object_=object;this.available=this.hasProperty('canPlayType')&&this.hasPlayableSource_();this.hackTimerInterval_=1000/10;this.hackTimerId_=null;this.isBindEvents_=false;this.isUnloading_=false;this.ready=false;this.started=false;this.canplay=false;this.currentTime_=0;this.progress_=0;this.duration_=0;if(!this.available)return;this.bindEvents_();if(element['playing'])this.playingHandler__();this.readyHandler__()}inherits(MediaController,EventTargetController);MediaController.prototype.bindEvents_=function(){if(this.isBindEvents_)return;this.isBindEvents_=true;this.object_.bind("canplay",proxy(this.canplayHandler__,this));this.object_.bind("playing",proxy(this.playingHandler__,this));this.object_.bind("play",proxy(this.playingHandler__,this));this.object_.bind("pause",proxy(this.pauseHandler__,this));this.object_.bind("ended",proxy(this.endedHandler__,this));this.object_.bind("timeupdate",proxy(this.timeupdateHandler__,this));this.object_.bind("progress",proxy(this.progressHandler__,this));this.object_.bind("durationchange",proxy(this.durationchangeHandler__,this));this.object_.bind("volumechange",proxy(this.volumechangeHandler__,this));this.object_.bind("error",proxy(this.errorHandler__,this))};MediaController.prototype.unbindEvents_=function(){if(!this.isBindEvents_)return;this.isBindEvents_=false;this.object_.unbind("canplay",this.canplayHandler__);this.object_.unbind("playing",this.playingHandler__);this.object_.unbind("play",this.playingHandler__);this.object_.unbind("pause",this.pauseHandler__);this.object_.unbind("ended",this.endedHandler__);this.object_.unbind("timeupdate",this.timeupdateHandler__);this.object_.unbind("progress",this.progressHandler__);this.object_.unbind("durationchange",this.durationchangeHandler__);this.object_.unbind("volumechange",this.volumechangeHandler__);this.object_.unbind("error",this.errorHandler__)};MediaController.prototype.destroy=function(){this.unbindEvents_();MediaController.superClass_.destroy.call(this)};MediaController.prototype.reset_=function(){this.canplay=false;this.started=false;this.currentTime_=0;this.progress_=0;this.duration_=0};MediaController.prototype.hasPlayableSource_=function(){var sources=find(this.object_,'source');var self=this;var newSource;sources.each(function(i){var src=$(this).attr('src');var type=getAudioTypeBySource(src);var canplay=self.canPlayType(type);if(canplay=='maybe'||canplay=='probably'){newSource=src;return false}});return newSource||false};MediaController.prototype.hasProperty=function(property){return isDefined(this.element_[property])};MediaController.prototype.canPlayType=function(type){return this.element_['canPlayType'](type)};MediaController.prototype.autoplay=function(){return this.element_['autoplay']};MediaController.prototype.setAutoplay=function(value){this.element_['autoplay']=value};MediaController.prototype.loop=function(){return this.element_['loop']||is(this.object_,'[loop]')};MediaController.prototype.setLoop=function(value){this.element_['loop']=value};MediaController.prototype.preload=function(){return this.element_['preload']};MediaController.prototype.setPreload=function(value){this.element_['preload']=value};MediaController.prototype.duration=function(){return this.duration_||this.element_['duration']};MediaController.prototype.ended=function(){return this.element_['ended']};MediaController.prototype.paused=function(){return this.element_['paused']};MediaController.prototype.currentSrc=function(){return this.currentSource_||this.element_['currentSrc']};MediaController.prototype.src=function(){return this.element_['src']};MediaController.prototype.setSrc=function(source){this.element_['src']=source;this.currentSource_=source};MediaController.prototype.volume=function(){return this.element_['volume']};MediaController.prototype.setVolume=function(value){this.element_['volume']=keepInBound(value)};MediaController.prototype.progress=function(){return this.progress_};MediaController.prototype.currentTime=function(){return this.currentTime_||this.element_['currentTime']};MediaController.prototype.setCurrentTime=function(value){if(this.element_['currentTime']!=value){this.element_['currentTime']=keepInBound(value,this.duration())}};MediaController.prototype.play=function(opt_element){if(isDefined(opt_element)){var element;if(typeof opt_element==='object')element=opt_element;else if(typeof opt_element==='string')element=win['getElementById'](opt_element);if(element&&element.tagName.toLowerCase()=='audio')this.load(element['currentSrc']||element['src'])}this.element_['play']()};MediaController.prototype.pause=function(){this.element_['pause']()};MediaController.prototype.load=function(opt_source){var src=opt_source||this.currentSource_;if(src){this.setSrc(src)}this.reset_();this.bindEvents_();this.element_['load']()};MediaController.prototype.unload=function(){this.isUnloading_=true;this.pause();this.setCurrentTime(0);this.unbindEvents_();this.reset_();this.element_['src']='';this.element_['load']()};MediaController.prototype.startTimer_=function(){if(!this.hackTimerId_){this.hackTimerId_=setInterval(proxy(this.timerHandler_,this),this.hackTimerInterval_);this.timerHandler_()}};MediaController.prototype.stopTimer_=function(){if(this.hackTimerId_){clearInterval(this.hackTimerId_);this.hackTimerId_=null}};MediaController.prototype.timerHandler_=function(){this.timeupdateHandler__();this.progressHandler__();this.canplayHandler__();this.startedHandler__()};MediaController.prototype.readyHandler__=function(){this.ready=true;this.dispatchEvent("ready")};MediaController.prototype.progressHandler__=function(e){if(this.hasEventListener("progress")){var buffered=this.element_['buffered'];var duration=this.element_['duration'];if(buffered&&duration){var length=buffered.length;if(length){var diff=duration;var index=length-1;var number=this.element_['currentTime'];for(var i=0;i<length;i++){var buffer=buffered['end'](i);if(buffer>=number&&buffer<diff){diff=buffer;index=i}}var progress=parseInt(buffered['end'](index)/duration*100,10);if(this.progress_!=progress){this.progress_=progress;this.dispatchEvent("progress")}}}else if(e){var originalEvent=e['originalEvent'];var bytesLoaded=originalEvent['loaded'];var bytesTotal=originalEvent['total'];if(bytesLoaded&&bytesTotal){var progress=parseInt(bytesLoaded/bytesTotal*100,10);if(this.progress_!=progress){this.progress_=progress;this.dispatchEvent("progress")}}}}};MediaController.prototype.timeupdateHandler__=function(){var time=this.element_['currentTime'];if(this.currentTime_!=time){this.currentTime_=time;this.dispatchEvent("timeupdate")}};MediaController.prototype.durationchangeHandler__=function(){var duration=this.element_['duration'];if(this.duration_!=duration){this.duration_=duration;this.dispatchEvent("durationchange")}};MediaController.prototype.volumechangeHandler__=function(){this.dispatchEvent("volumechange")};MediaController.prototype.canplayHandler__=function(e){if(this.hasEventListener("canplay")){if(!this.canplay){if(isDefined(e)||!isNaN(this.element_['duration'])){this.canplay=true;this.dispatchEvent("canplay")}}}};MediaController.prototype.startedHandler__=function(e){if(!this.started){if(isDefined(e)||this.currentTime()>0){this.started=true;this.dispatchEvent("started")}}};MediaController.prototype.playingHandler__=function(){this.startTimer_();this.canplayHandler__();this.startedHandler__();this.dispatchEvent("playing")};MediaController.prototype.pauseHandler__=function(){this.stopTimer_();this.dispatchEvent("pause")};MediaController.prototype.endedHandler__=function(){this.stopTimer_();this.started=false;this.dispatchEvent("ended")};MediaController.prototype.errorHandler__=function(){this.stopTimer_();if(this.isUnloading_){this.isUnloading_=false}else{this.dispatchEvent("error")}};function FlashFallbackController(object,element){MediaController.call(this,object,element);if(this.available)return;this.flashMode_=true;this.flashId_='HTML5AudioPlayerID_'+initCount;var player=(object.attr(Attributes.DATA_FALLBACK)||$[FN][AUDIO_PLAYER_ID]['defaultOptions'][Attributes.DATA_FALLBACK]);var audio=this.getPlayableFlashSource_();var volume=1;var loop=object.attr('loop')?true:false;var autoplay=object.attr('autoplay')?true:false;var preload=object.attr('preload')=='auto';this.swf_=null;flashCollection[this.flashId_]=this;if(flashAvailable()&&audio){this.available=true;createSWF(this.flashId_,object,player,audio,volume,loop,autoplay,preload)}}inherits(FlashFallbackController,MediaController);FlashFallbackController.prototype.destroy=function(){FlashFallbackController.superClass_.destroy.call(this);if(this.swf_)this.swf_.remove();flashCollection.splice(this.flashId_,1)};FlashFallbackController.prototype.flashCall_=function(functionName){if(this.available&&this.swf_&&isDefined(this.swf_[PREFIX_CALLBACK+functionName])){return this.swf_[PREFIX_CALLBACK+functionName]()}};FlashFallbackController.prototype.flashCallWidth_=function(functionName,opt_parameter){if(this.available&&this.swf_&&isDefined(this.swf_[PREFIX_CALLBACK+functionName])){return this.swf_[PREFIX_CALLBACK+functionName](opt_parameter)}};FlashFallbackController.prototype.play=function(opt_element){if(this.flashMode_){if(!isDefined(opt_element)){this.flashCall_('play')}}else{FlashFallbackController.superClass_.play.call(this,opt_element)}};FlashFallbackController.prototype.pause=function(){if(this.flashMode_)this.flashCall_('pause');else FlashFallbackController.superClass_.pause.call(this)};FlashFallbackController.prototype.getPlayableFlashSource_=function(){if(this.flashSource_){return this.flashSource_}else{var sources=find(this.object_,'source');var self=this;var newSource;sources.each(function(i){var src=$(this).attr('src');var type=getAudioTypeBySource(src);if(type=='audio/mpeg'||type=='audio/mp4'||type=='audio/wav'){newSource=src;return false}});this.flashSource_=newSource||false;return this.flashSource_}};FlashFallbackController.prototype.hasPlayableSource_=function(){if(this.flashMode_)return this.getPlayableFlashSource_()?true:false;else return FlashFallbackController.superClass_.hasPlayableSource_.call(this)};FlashFallbackController.prototype.autoplay=function(){if(this.flashMode_)return this.flashCall_('autoplay');else return FlashFallbackController.superClass_.autoplay.call(this)};FlashFallbackController.prototype.setAutoplay=function(value){if(this.flashMode_)this.flashCallWidth_('setAutoplay',value);else FlashFallbackController.superClass_.setAutoplay.call(this,value)};FlashFallbackController.prototype.loop=function(){if(this.flashMode_)return this.flashCall_('loop');else return FlashFallbackController.superClass_.loop.call(this)};FlashFallbackController.prototype.setLoop=function(value){if(this.flashMode_)this.flashCallWidth_('setLoop',value);else FlashFallbackController.superClass_.setLoop.call(this,value)};FlashFallbackController.prototype.preload=function(){if(this.flashMode_)return this.flashCall_('preload');else return FlashFallbackController.superClass_.preload.call(this)};FlashFallbackController.prototype.setPreload=function(value){if(this.flashMode_){value=value==false||value=='false'||value=='none'?false:true;this.flashCallWidth_('setPreload',value)}else FlashFallbackController.superClass_.setPreload.call(this,value)};FlashFallbackController.prototype.duration=function(){if(this.flashMode_)return this.duration_||this.flashCall_('duration');else return FlashFallbackController.superClass_.duration.call(this)};FlashFallbackController.prototype.ended=function(){if(this.flashMode_)return this.flashCall_('ended');else return FlashFallbackController.superClass_.ended.call(this)};FlashFallbackController.prototype.paused=function(){if(this.flashMode_)return this.flashCall_('paused');else return FlashFallbackController.superClass_.paused.call(this)};FlashFallbackController.prototype.currentSrc=function(){if(this.flashMode_)return this.flashCall_('currentSrc');else return FlashFallbackController.superClass_.currentSrc.call(this)};FlashFallbackController.prototype.src=function(){if(this.flashMode_)return this.flashCall_('src');else return FlashFallbackController.superClass_.src.call(this)};FlashFallbackController.prototype.setSrc=function(value){if(this.flashMode_)this.flashCallWidth_('setSrc',value);else FlashFallbackController.superClass_.setSrc.call(this,value)};FlashFallbackController.prototype.volume=function(){if(this.flashMode_)return this.flashCall_('volume');else return FlashFallbackController.superClass_.volume.call(this)};FlashFallbackController.prototype.setVolume=function(value){if(this.flashMode_)this.flashCallWidth_('setVolume',value);else FlashFallbackController.superClass_.setVolume.call(this,value)};FlashFallbackController.prototype.progress=function(){if(this.flashMode_)return this.progress_||this.flashCall_('progress');else return FlashFallbackController.superClass_.progress.call(this)};FlashFallbackController.prototype.currentTime=function(){if(this.flashMode_)return this.currentTime_||this.flashCall_('currentTime');else return FlashFallbackController.superClass_.currentTime.call(this)};FlashFallbackController.prototype.setCurrentTime=function(value){if(this.flashMode_)this.flashCallWidth_('setCurrentTime',value);else FlashFallbackController.superClass_.setCurrentTime.call(this,value)};FlashFallbackController.prototype.load=function(opt_source){if(this.flashMode_)this.flashCallWidth_('load',opt_source);else FlashFallbackController.superClass_.load.call(this,opt_source)};FlashFallbackController.prototype.unload=function(){if(this.flashMode_)this.flashCall_('unload');else FlashFallbackController.superClass_.unload.call(this)};FlashFallbackController.prototype.readyHandler__=function(){if(this.flashMode_){this.ready=true;this.dispatchEvent("ready")}else FlashFallbackController.superClass_.readyHandler__.call(this)};FlashFallbackController.prototype.timeupdateHandler__=function(){if(this.flashMode_)this.dispatchEvent("timeupdate");else FlashFallbackController.superClass_.timeupdateHandler__.call(this)};FlashFallbackController.prototype.progressHandler__=function(){if(this.flashMode_)this.dispatchEvent("progress");else FlashFallbackController.superClass_.progressHandler__.call(this)};FlashFallbackController.prototype.canplayHandler__=function(){if(this.flashMode_)this.dispatchEvent("canplay");else FlashFallbackController.superClass_.canplayHandler__.call(this)};FlashFallbackController.prototype.playingHandler__=function(){if(this.flashMode_)this.dispatchEvent("playing");else FlashFallbackController.superClass_.playingHandler__.call(this)};FlashFallbackController.prototype.startingHandler__=function(){if(this.flashMode_)this.dispatchEvent("started");else FlashFallbackController.superClass_.startingHandler__.call(this)};FlashFallbackController.prototype.playHandler__=function(){if(this.flashMode_)this.dispatchEvent("play");else FlashFallbackController.superClass_.playHandler__.call(this)};FlashFallbackController.prototype.pauseHandler__=function(){if(this.flashMode_)this.dispatchEvent("pause");else FlashFallbackController.superClass_.pauseHandler__.call(this)};FlashFallbackController.prototype.endedHandler__=function(){if(this.flashMode_)this.dispatchEvent("ended");else FlashFallbackController.superClass_.endedHandler__.call(this)};FlashFallbackController.prototype.volumechangeHandler__=function(){if(this.flashMode_)this.dispatchEvent("volumechange");else FlashFallbackController.superClass_.volumechangeHandler__.call(this)};FlashFallbackController.prototype.durationchangeHandler__=function(){if(this.flashMode_)this.dispatchEvent("durationchange");else FlashFallbackController.superClass_.durationchangeHandler__.call(this)};FlashFallbackController.prototype.errorHandler__=function(){if(this.flashMode_)this.dispatchEvent("error");else FlashFallbackController.superClass_.errorHandler__.call(this)};function AudioPlayer(object,element){FlashFallbackController.call(this,object,element);this.identifier_=initCount++;this.offset_=0;this.time_=0;this.isSeekingTimeline_=false;this.isSeekingVolume_=false;this.isMuted_=false;var that=this;var attrWidth=object.attr(Attributes.WIDTH);var attrHeight=object.attr(Attributes.HEIGHT);this.playerWidth_=attrWidth||$['fn'][AUDIO_PLAYER_ID]['defaultOptions'][Attributes.WIDTH];this.playerHeight_=attrHeight||$['fn'][AUDIO_PLAYER_ID]['defaultOptions'][Attributes.HEIGHT];var controlsDisplay=this.controlsDisplay_=$(TEMPLATE);this.playButton_=controlsDisplay.find('.play-btn');this.timeTextDisplay_=controlsDisplay.find('.time-txt');this.containerDisplay_=controlsDisplay.find('.container');this.progressContainerDisplay_=controlsDisplay.find('.progress-bar-container');this.progressWrapperDisplay_=controlsDisplay.find('.progress-bar-wrapper');this.seekBarDisplay_=controlsDisplay.find('.seek-bar');this.playBarDisplay_=controlsDisplay.find('.play-bar');this.durationTextDisplay_=controlsDisplay.find('.duration-txt');this.volumeButton_=controlsDisplay.find('.volume-btn');this.volumeContainerDisplay_=controlsDisplay.find('.volume-bar-container');this.volumeBarDisplay_=controlsDisplay.find('.volume-bar');controlsDisplay.width(this.playerWidth_);controlsDisplay.height(this.playerHeight_);this.bindControllerEvents_();this.checkAttributes_();object.after(this.controlsDisplay_);object.width(0);object.height(0);object.removeAttr(Attributes.CONTROLS);if(!this.checkForAvailability_())return;this.setContainerWidth_();this.bindAudioEvents_();if(this.ready)this.readyHandler_();collection[this.identifier_]=this;$(window).resize(function(){that.containerResized()});this.intervalId=setInterval(function(){var ow=controlsDisplay.get(0).offsetWidth;if(ow>0){clearInterval(that.intervalId);that.playerWidth_=ow;that.setContainerWidth_()}},100)}inherits(AudioPlayer,FlashFallbackController);AudioPlayer.prototype.destroy=function(){this.unbindAudioEvents_();this.unbindControllerEvents_();this.unbindVolumeEvents_();this.unbindStartingEvents_();this.unbindPlayEvents_();this.controlsDisplay_.remove();collection.splice(this.identifier_,1);AudioPlayer.superClass_.destroy.call(this)};AudioPlayer.prototype.containerResized=function(){this.playerWidth_=this.controlsDisplay_.width();this.setContainerWidth_()};AudioPlayer.prototype.bindControllerEvents_=function(){this.controlsDisplay_.bind("mousedown",false);this.controlsDisplay_.bind("contextmenu",false)};AudioPlayer.prototype.unbindControllerEvents_=function(){this.controlsDisplay_.unbind("mousedown");this.controlsDisplay_.unbind("contextmenu")};AudioPlayer.prototype.bindPlayEvents_=function(){this.progressWrapperDisplay_.bind("mousedown",proxy(this.onSeekDownHandler_,this));this.playButton_.bind("click",proxy(this.toggleAudio_,this))};AudioPlayer.prototype.unbindPlayEvents_=function(){this.progressWrapperDisplay_.unbind("mousedown",this.onSeekDownHandler_);this.playButton_.unbind("click",this.toggleAudio_)};AudioPlayer.prototype.bindStartingEvents_=function(){bind(this.playButton_,"click",proxy(this.startAudio_,this))};AudioPlayer.prototype.unbindStartingEvents_=function(){unbind(this.playButton_,"click",this.startAudio_)};AudioPlayer.prototype.bindVolumeEvents_=function(){this.volumeContainerDisplay_.bind("mousedown",proxy(this.onVolumeDownHandler_,this));this.volumeButton_.bind("click",proxy(this.toggleVolume_,this))};AudioPlayer.prototype.unbindVolumeEvents_=function(){this.volumeContainerDisplay_.unbind("mousedown",this.onVolumeDownHandler_);this.volumeButton_.unbind("click",this.toggleVolume_)};AudioPlayer.prototype.bindAudioEvents_=function(){this.addEventListener("ready",this.readyHandler_);this.addEventListener("progress",this.progressHandler_);this.addEventListener("timeupdate",this.timeupdateHandler_);this.addEventListener("canplay",this.canplayHandler_);this.addEventListener("durationchange",this.durationchangeHandler_);this.addEventListener("playing",this.playHandler_);this.addEventListener("play",this.playHandler_);this.addEventListener("pause",this.pauseHandler_);this.addEventListener("ended",this.endedHandler_);this.addEventListener("error",this.errorHandler_);this.addEventListener("volumechange",this.volumechangeHandler_)};AudioPlayer.prototype.unbindAudioEvents_=function(){this.removeEventListener("ready",this.readyHandler_);this.removeEventListener("timeupdate",this.timeupdateHandler_);this.removeEventListener("canplay",this.canplayHandler_);this.removeEventListener("durationchange",this.durationchangeHandler_);this.removeEventListener("playing",this.playHandler_);this.removeEventListener("play",this.playHandler_);this.removeEventListener("pause",this.pauseHandler_);this.removeEventListener("ended",this.endedHandler_);this.removeEventListener("error",this.errorHandler_);this.removeEventListener("volumechange",this.volumechangeHandler_)};AudioPlayer.prototype.readyHandler_=function(){var attrVol=this.object_.attr(Attributes.DATA_VOLUME);var vol=((attrVol?(keepInBound(attrVol,100)/100):null)||getVolumeState()||($[FN][AUDIO_PLAYER_ID]['defaultOptions'][Attributes.DATA_VOLUME]/100));if(isDefined(vol))this.setVolume(vol);else vol=this.volume();this.setVolumeView_(vol);this.bindStartingEvents_();this.bindVolumeEvents_()};AudioPlayer.prototype.checkAttributes_=function(){if(!this.hasBooleanAttribute_(Attributes.DATA_CONTROLS_TIME)){this.timeTextDisplay_.css("display","none");var obj=this.controlsDisplay_.find('.for-time');obj.css("display","none")}if(!this.hasBooleanAttribute_(Attributes.DATA_CONTROLS_DURATION)){this.durationTextDisplay_.css("display","none");var obj=this.controlsDisplay_.find('.for-duration');obj.css("display","none")}if(!this.hasBooleanAttribute_(Attributes.DATA_CONTROLS_VOLUME)){this.volumeButton_.css("display","none");this.volumeContainerDisplay_.css("display","none");var obj=this.controlsDisplay_.find('.for-volume');obj.css("display","none")}};AudioPlayer.prototype.hasBooleanAttribute_=function(attributeName){var val=this.object_.attr(attributeName);if(val){if(val=='false'||val=='off'||val=='no')return false;else if(val=='true'||val=='on'||val=='yes')return true}return $[FN][AUDIO_PLAYER_ID]['defaultOptions'][attributeName]};AudioPlayer.prototype.setContainerWidth_=function(){var widthMin=0;var obj=find(this.controlsDisplay_,'li:not(.container)');obj.each(function(){widthMin+=$(this).width()});if(widthMin>this.playerWidth_){$win.load(proxy(this.setContainerWidth_,this));return}this.containerDisplay_.width(this.playerWidth_-widthMin)};AudioPlayer.prototype.checkForAvailability_=function(){if(!this.available){this.reportError_('Audio file not found.');return}return true};AudioPlayer.prototype.canplayHandler_=function(){this.unbindStartingEvents_();this.bindPlayEvents_()};AudioPlayer.prototype.startAudio_=function(){if(!this.flashMode_)this.setPreload('auto');this.play();this.unbindStartingEvents_()};AudioPlayer.prototype.toggleAudio_=function(){if(this.paused()||this.ended()){this.play();this.controlsDisplay_.addClass("playing")}else{this.pause();this.controlsDisplay_.removeClass("playing")}};AudioPlayer.prototype.toggleVolume_=function(){if(this.volume())this.setVolume(0);else this.setVolume(1)};AudioPlayer.prototype.onVolumeDownHandler_=function(e){if(e.which!=1)return;e.preventDefault();e.stopPropagation();if(!isIE)this.isSeekingVolume_=true;this.offset_=getOffsetLeft(this.volumeContainerDisplay_);var pos=(e.pageX-this.offset_)/this.volumeContainerDisplay_.width();this.setVolume(pos);this.setVolumeView_(pos);$win.bind("mousemove",proxy(this.onVolumeMoveHandler_,this));$win.bind("mouseup",proxy(this.onVolumeUpHandler_,this));return false};AudioPlayer.prototype.onVolumeUpHandler_=function(){this.isSeekingVolume_=false;setVolumeState(this.volume());$win.unbind("mousemove",this.onVolumeMoveHandler_);$win.unbind("mouseup",this.onVolumeUpHandler_)};AudioPlayer.prototype.onVolumeMoveHandler_=function(e){var pos=keepInBound((e.pageX-this.offset_)/this.volumeContainerDisplay_.width());this.setVolume(pos);this.setVolumeView_(pos)};AudioPlayer.prototype.setVolumeView_=function(volume){this.volumeBarDisplay_.width(volume*100+'%');if(volume){if(this.isMuted_){this.isMuted_=false;this.controlsDisplay_.removeClass("mute")}}else if(!this.isMuted_){this.isMuted_=true;this.controlsDisplay_.addClass("mute")}};AudioPlayer.prototype.onSeekDownHandler_=function(e){if(e.which!=1)return;this.offset_=getOffsetLeft(this.seekBarDisplay_);var pos=keepInBound((e.pageX-this.offset_)/this.progressContainerDisplay_.width());var duration=this.duration();var time=duration*pos;this.time_=time;this.playBarDisplay_.removeClass("transition");this.playBarDisplay_.width(pos*100+'%');this.timeTextDisplay_.text(getCurrentTime(time,duration));$win.bind("mousemove",proxy(this.onSeekMoveHandler_,this));$win.bind("mouseup",proxy(this.onSeekUpHandler_,this));if(!isIE){this.isSeekingTimeline_=true;this.pause()}else{this.setCurrentTime(time);this.play()}return false};AudioPlayer.prototype.onSeekUpHandler_=function(){this.playBarDisplay_.addClass("transition");$win.unbind("mousemove",this.onSeekMoveHandler_);$win.unbind("mouseup",this.onSeekUpHandler_);this.setCurrentTime(this.time_);this.isSeekingTimeline_=false;this.play()};AudioPlayer.prototype.onSeekMoveHandler_=function(e){var pos=keepInBound((e.pageX-this.offset_)/this.progressContainerDisplay_.width());var duration=this.duration();var time=duration*pos;this.time_=time;this.playBarDisplay_.width(pos*100+'%');this.timeTextDisplay_.text(getCurrentTime(time,duration))};AudioPlayer.prototype.timeupdateHandler_=function(){var self=this;if(self.isSeekingTimeline_)return;var duration=self.duration();var time=self.currentTime();var pos=keepInBound(time/duration);callAnimationFrame(function(){self.playBarDisplay_.width(pos*100+'%');self.timeTextDisplay_.text(getCurrentTime(time,duration))},'1')};AudioPlayer.prototype.progressHandler_=function(){var self=this;callAnimationFrame(function(){self.seekBarDisplay_.width(self.progress()+'%')},'2')};AudioPlayer.prototype.volumechangeHandler_=function(){if(!this.isSeekingVolume_){var vol=roundNumber(this.volume());setVolumeState(vol);this.setVolumeView_(vol)}};AudioPlayer.prototype.durationchangeHandler_=function(){this.durationTextDisplay_.text(getCurrentTime(this.duration()));if(this.duration()/3600>=1){this.timeTextDisplay_.text(getCurrentTime(this.currentTime(),this.duration()));this.setContainerWidth_()}};AudioPlayer.prototype.playHandler_=function(){if(!this.isSeekingTimeline_){pauseAllAudioExcept(this);this.controlsDisplay_.addClass("playing")}};AudioPlayer.prototype.pauseHandler_=function(){if(!this.isSeekingTimeline_){this.controlsDisplay_.removeClass("playing")}};AudioPlayer.prototype.endedHandler_=function(){if(!this.isSeekingTimeline_){this.controlsDisplay_.removeClass("playing");if(this.loop()){this.setCurrentTime(0);this.play()}}};AudioPlayer.prototype.errorHandler_=function(){this.reportError_('An error occurred.')};AudioPlayer.prototype.reportError_=function(msg){this.unbindAudioEvents_();this.unbindControllerEvents_();this.unbindVolumeEvents_();this.unbindStartingEvents_();this.unbindPlayEvents_();this.timeTextDisplay_.css("display","block");this.timeTextDisplay_.text(msg);this.controlsDisplay_.addClass("error")};$(function(){$('.'+AUDIO_PLAYER_ID)[AUDIO_PLAYER_ID]()});$.widget('ui.'+AUDIO_PLAYER_ID,{'widgetEventPrefix':'audioplayer.','_create':function(){var self=this;var data=self['element'];var element=data[0];var object=$(element);if(is(object,'audio')){data.player_=new AudioPlayer(object,element);data.dispatcher_=function(e){self['_trigger'](e)};data.player_.addEventListener("started",data.dispatcher_);data.player_.addEventListener("ended",data.dispatcher_);data.player_.addEventListener("ready",data.dispatcher_)}},'destroy':function(){var data=this['element'];data.player_.removeEventListener("started",data.dispatcher_);data.player_.removeEventListener("ended",data.dispatcher_);data.player_.removeEventListener("ready",data.dispatcher_);delete data.dispatcher_;data.dispatcher_=null;data.player_.destroy();delete data.player_;data.player_=null},'play':function(opt_audioElement){var data=this['element'];data.player_.play(opt_audioElement)},'pause':function(){var data=this['element'];data.player_.pause()},'volume':function(value){var data=this['element'];if(value){var volume=parseInt(value,10)/100;data.player_.setVolume(volume)}else{return data.player_.volume()}}});var defaultOptions={};defaultOptions[Attributes.WIDTH]=300;defaultOptions[Attributes.HEIGHT]=29;defaultOptions[Attributes.DATA_CONTROLS_TIME]=true;defaultOptions[Attributes.DATA_CONTROLS_VOLUME]=true;defaultOptions[Attributes.DATA_CONTROLS_DURATION]=true;defaultOptions[Attributes.DATA_VOLUME]=100;defaultOptions[Attributes.DATA_FALLBACK]='flash/audio-player.swf';$[FN][AUDIO_PLAYER_ID]['defaultOptions']=defaultOptions;var flash_proto={};flash_proto["ready"]=function(id){setTimeout(function(){var obj=flashCollection[id];obj.swf_=getObjectById(id);obj.readyHandler__.call(obj)},1)};flash_proto["timeupdate"]=function(id,time){var obj=flashCollection[id];obj.currentTime_=time;obj.timeupdateHandler__()};flash_proto["progress"]=function(id,progress){var obj=flashCollection[id];obj.progress_=progress;obj.progressHandler__()};flash_proto["canplay"]=function(id){flashCollection[id].canplayHandler__()};flash_proto["playing"]=function(id){flashCollection[id].playingHandler__()};flash_proto["started"]=function(id){flashCollection[id].startingHandler__()};flash_proto["play"]=function(id){flashCollection[id].playHandler__()};flash_proto["pause"]=function(id){flashCollection[id].pauseHandler__()};flash_proto["ended"]=function(id){flashCollection[id].endedHandler__()};flash_proto["volumechange"]=function(id){lashCollection[id].volumechangeHandler__()};flash_proto["durationchange"]=function(id,duration){var obj=flashCollection[id];obj.duration_=duration;obj.durationchangeHandler__()};flash_proto["error"]=function(id,msg){flashCollection[id].errorHandler__()};$[FN][AUDIO_PLAYER_ID][PREFIX_FLASH_PROTO]=flash_proto})(jQuery);